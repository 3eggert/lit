{"version":3,"sources":["src/lit/backend/localizations.js","src/lit/backend/sources.js"],"names":["edited_rows","document","addEventListener","localizationRows","querySelectorAll","forEach","row","parseInt","e","target","dataset","editing","id","innerHTML","rowElem","querySelector","edit","fetch","then","resp","json","html","isHtmlKey","focus","click","url","action","method","headers","Rails","csrfToken","body","JSON","stringify","localization","translated_value","value","localizationId","parentElement","classList","remove","checked","preventDefault","allLocalizationRows","matches","refElem","localName","parentNode","localizationVersionsRows","add","td","localizationKeyRows","textarea","pellElement","content","pell","init","element","onChange","style","display","requestInfoRow","contains","loadingElement","updateFunc","sourceIdElement","sourceId","ok","Promise","reject","status","sync_complete","clearInterval","interval","location","reload","catch","error","window","setInterval"],"mappings":"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","file":"app/assets/javascripts/lit/app.js","sourcesContent":["import pell from 'pell';\n\nlet edited_rows = {};\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const localizationRows = document.querySelectorAll('td.localization_row[data-editing=\"0\"]');\n\n  localizationRows.forEach(row => {\n    row.addEventListener('click', e => {\n      if (!parseInt(e.target.dataset.editing)) {\n        edited_rows[e.target.dataset.id] = e.target.innerHTML;\n        const rowElem = document.querySelector(`td.localization_row[data-id=\"${e.target.dataset.id}\"]`);\n        if (!parseInt(e.target.dataset.editing) && e.target.dataset.edit) {\n          e.target.dataset.editing = '1';\n          fetch(e.target.dataset.edit)\n          .then(resp => resp.json())\n          .then(({html, isHtmlKey}) => {\n            rowElem.dataset.editing = 1;\n            rowElem.innerHTML = html;\n            rowElem.querySelector('textarea').focus();\n            if (isHtmlKey) {\n              rowElem.querySelector('.wysiwyg_switch').click()\n            }\n            rowElem.querySelector('form').addEventListener('submit', e => {\n              const url = e.target.action;\n              fetch(url, {\n                method: 'PATCH',\n                headers: {\n                  'X-CSRF-Token': Rails.csrfToken(),\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                  localization: {\n                    translated_value: rowElem.querySelector('textarea').value\n                  }\n                })\n              })\n              .then(resp => resp.json())\n              .then(({localizationId, html}) => {\n                delete rowElem.dataset.editing;\n                rowElem.innerHTML = html;\n                rowElem.parentElement.querySelector('.show_prev_versions').classList.remove('hidden');\n                document.querySelector(`a.change_completed_${localizationId} input[type=\"checkbox\"]`).checked = true;\n              })\n              e.preventDefault();\n            })\n          });\n        }\n      }\n    })\n  });\n\n  const allLocalizationRows = document.querySelectorAll('td.localization_row');\n\n  allLocalizationRows.forEach(row => {\n    row.addEventListener('click', e => {\n      if (e.target.matches('form button.cancel')) {\n        let refElem = e.target;\n        if (refElem.localName === 'button') {\n          while (!refElem.matches('td.localization_row')) {\n            refElem = refElem.parentNode;\n            if (!refElem) { return; }\n          }\n          refElem.dataset.editing = '0';\n          refElem.innerHTML = edited_rows[refElem.dataset.id];\n          e.preventDefault();\n          return false;\n        }\n      }\n    })\n  });\n\n  const localizationVersionsRows = document.querySelectorAll('tr.localization_versions_row');\n\n  localizationVersionsRows.forEach(row => {\n    row.addEventListener('click', e => {\n      if (e.target.matches('.close_versions')) {\n        let refElem = e.target;\n        while (!refElem.matches('tr.localization_versions_row')) {\n          refElem = refElem.parentNode;\n          if (!refElem) { return; }\n        }\n        refElem.classList.add('hidden');\n        refElem.querySelectorAll('td').forEach(td => td.innerHTML = '');\n      }\n    })\n  });\n\n  const localizationKeyRows = document.querySelectorAll('tr.localization_key_row');\n\n  localizationKeyRows.forEach(row => {\n    row.addEventListener('click', e => {\n      if (e.target.matches('input.wysiwyg_switch')) {\n        let refElem = e.target;\n        while (!refElem.matches('form')) {\n          refElem = refElem.parentNode;\n          if (!refElem) { return; }\n        }\n        const textarea = refElem.querySelector('textarea');\n        const pellElement = refElem.querySelector('.pell');\n\n        if (e.target.checked) {\n          if (!pellElement.content) {\n            pell.init({\n              element: pellElement,\n              onChange: html => textarea.value = html\n            });\n          }\n\n          pellElement.content.innerHTML = textarea.value;\n          textarea.style.display = 'none';\n          pellElement.style.display = '';\n        } else {\n          textarea.style.display = '';\n          pellElement.style.display = 'none';\n        }\n      }\n\n      if (e.target.matches('.request_info_link')) {\n        let refElem = e.target;\n        while (!refElem.matches('tr.localization_key_row')) {\n          refElem = refElem.parentNode;\n          if (!refElem) { return; }\n        }\n        requestInfoRow = refElem.querySelector('.request_info_row');\n        if (requestInfoRow.classList.contains('hidden')) {\n          requestInfoRow.classList.remove('hidden');\n        } else {\n          requestInfoRow.classList.add('hidden');\n        }\n      }\n    });\n  });\n})","document.addEventListener('DOMContentLoaded', () => {\n  const loadingElement = document.querySelector('.loading');\n\n  const updateFunc = () => {\n    const sourceIdElement = document.querySelector('#source_id');\n    if (!sourceIdElement) { return; }\n\n    const sourceId = sourceIdElement.value;\n\n    fetch(`/lit/sources/${sourceId}/sync_complete`)\n      .then(resp => {\n        if (resp.ok) {\n          return resp.json();\n        } else {\n          return Promise.reject({ status: resp.status });\n        }\n      })\n      .then(json => {\n        if (json.sync_complete) {\n          loadingElement.classList.add('loaded');\n          loadingElement.classList.remove('loading');\n          clearInterval(interval);\n          location.reload();\n        }\n      })\n      .catch(error => {\n        switch (error.status) {\n          case 404:\n            loadingElement.innerHTML = 'Could not update synchronization status, please try refreshing page';\n            break;\n          case 401:\n            loadingElement.innerHTML = 'You are not authorized. Please check if you are properly logged in';\n            break;\n          case 500:\n            loadingElement.innerHTML = 'Something went wrong, please try synchronizing again';\n            break;\n          default:\n            loadingElement.innerHTML = 'An unknown error occurred. Please try again'\n        }\n        clearInterval(interval);\n      });\n  }\n\n  if (loadingElement) {\n    window.interval = setInterval(updateFunc, 500);\n  }\n})"]}