{"version":3,"sources":["src/lit/backend/locales.js","src/lit/backend/localizations.js","src/lit/backend/sources.js","src/lit/backend/ui.js","src/lit/utils.js"],"names":["document","addEventListener","handleHideLocaleLinkClick","e","preventDefault","fetch","target","href","method","headers","Rails","csrfToken","then","resp","json","hidden","innerHTML","querySelectorAll","forEach","link","edited_rows","localizationRows","row","tdElem","currentTarget","parseInt","dataset","editing","id","rowElem","querySelector","edit","html","isHtmlKey","focus","click","url","action","body","JSON","stringify","localization","translated_value","value","localizationId","parentElement","classList","remove","checked","handleCloudTranslationLinkClick","translatedText","textareaElem","pellElement","content","inputElems","inputElem","i","allLocalizationRows","matches","localName","refElem","Utils","closest","localizationVersionsRows","add","td","localizationKeyRows","textarea","pell","init","element","defaultParagraphSeparator","onChange","style","display","requestInfoRow","contains","loadingElement","updateFunc","sourceIdElement","sourceId","ok","Promise","reject","status","sync_complete","clearInterval","interval","location","reload","catch","error","window","setInterval","tableElem","button","alert","confirm","acceptButtons","rejectButtons","_dropdownOpen","toggle","dropdown","selector","parentNode"],"mappings":"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","file":"app/assets/javascripts/lit/app.js","sourcesContent":["document.addEventListener('DOMContentLoaded', () => {\n  const handleHideLocaleLinkClick = e => {\n    e.preventDefault;\n    fetch(e.target.href, {\n      method: 'PUT',\n      headers: {\n        'X-CSRF-Token': Rails.csrfToken(),\n        'Content-Type': 'application/json'\n      }\n    }).then(resp => resp.json())\n      .then(({ hidden }) => {\n        e.target.innerHTML = hidden ? 'Show' : 'Hide';\n      })\n  }\n\n  document.querySelectorAll('.js-hide-locale-link')\n    .forEach(link => link.addEventListener('click', handleHideLocaleLinkClick));\n})","import pell from 'pell';\nimport Utils from '../utils';\n\nlet edited_rows = {};\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const localizationRows = document.querySelectorAll('td.localization_row[data-editing=\"0\"]');\n\n  localizationRows.forEach(row => {\n    row.addEventListener('click', e => {\n      const tdElem = e.currentTarget;\n      if (!parseInt(tdElem.dataset.editing)) {\n        edited_rows[tdElem.dataset.id] = tdElem.innerHTML;\n        const rowElem = document.querySelector(`td.localization_row[data-id=\"${tdElem.dataset.id}\"]`);\n        if (!parseInt(tdElem.dataset.editing) && tdElem.dataset.edit) {\n          tdElem.dataset.editing = '1';\n          fetch(tdElem.dataset.edit)\n            .then(resp => resp.json())\n            .then(({ html, isHtmlKey }) => {\n              rowElem.dataset.editing = 1;\n              rowElem.innerHTML = html;\n              rowElem.querySelector('textarea, input').focus();\n              if (isHtmlKey) {\n                rowElem.querySelector('.wysiwyg_switch').click()\n              }\n\n              rowElem.querySelector('form').addEventListener('submit', e => {\n                const url = e.target.action;\n                fetch(url, {\n                  method: 'PATCH',\n                  headers: {\n                    'X-CSRF-Token': Rails.csrfToken(),\n                    'Content-Type': 'application/json'\n                  },\n                  body: JSON.stringify({\n                    localization: {\n                      translated_value: rowElem.querySelector('textarea').value\n                    }\n                  })\n                })\n                  .then(resp => resp.json())\n                  .then(({ localizationId, html }) => {\n                    delete rowElem.dataset.editing;\n                    rowElem.innerHTML = html;\n                    rowElem.parentElement.querySelector('.show_prev_versions').classList.remove('hidden');\n                    document.querySelector(`a.change_completed_${localizationId} input[type=\"checkbox\"]`).checked = true;\n                  })\n                e.preventDefault();\n              });\n\n              const handleCloudTranslationLinkClick = e => {\n                e.preventDefault();\n                const url = e.target.href;\n                fetch(url).then(resp => resp.json()).then(\n                  ({ translatedText }) => {\n                    if (typeof (translatedText) === 'string') {\n                      const textareaElem = rowElem.querySelector('textarea');\n                      textareaElem.value = translatedText;\n                      if (isHtmlKey) {\n                        const pellElement = rowElem.querySelector('.pell');\n                        pellElement.content.innerHTML = translatedText;\n                      }\n                    } else if (typeof (translatedText) === 'object') {\n                      const inputElems = rowElem.querySelectorAll('input[type=\"text\"]');\n                      inputElems.forEach((inputElem, i) => inputElem.value = translatedText[i]);\n                    }\n                  }\n                );\n              }\n\n              rowElem.querySelectorAll('.js-cloud-translation-link').forEach(link => {\n                link.addEventListener('click', handleCloudTranslationLinkClick);\n              });\n            });\n        }\n      }\n    })\n  });\n\n  const allLocalizationRows = document.querySelectorAll('td.localization_row');\n\n  allLocalizationRows.forEach(row => {\n    row.addEventListener('click', e => {\n      if (e.target.matches('form button.cancel')) {\n        if (e.target.localName === 'button') {\n          const refElem = Utils.closest(e.target, 'td.localization_row');\n          refElem.dataset.editing = '0';\n          refElem.innerHTML = edited_rows[refElem.dataset.id];\n          e.preventDefault();\n          return false;\n        }\n      }\n    })\n  });\n\n  const localizationVersionsRows = document.querySelectorAll('tr.localization_versions_row');\n\n  localizationVersionsRows.forEach(row => {\n    row.addEventListener('click', e => {\n      if (e.target.matches('.close_versions')) {\n        const refElem = Utils.closest(e.target, 'tr.localization_versions_row');\n        refElem.classList.add('hidden');\n        refElem.querySelectorAll('td').forEach(td => td.innerHTML = '');\n      }\n    })\n  });\n\n  const localizationKeyRows = document.querySelectorAll('tr.localization_key_row');\n\n  localizationKeyRows.forEach(row => {\n    row.addEventListener('click', e => {\n      if (e.target.matches('input.wysiwyg_switch')) {\n        const refElem = Utils.closest(e.target, 'form');\n        const textarea = refElem.querySelector('textarea');\n        const pellElement = refElem.querySelector('.pell');\n\n        if (e.target.checked) {\n          if (!pellElement.content) {\n            pell.init({\n              element: pellElement,\n              defaultParagraphSeparator: '',\n              onChange: html => textarea.value = html\n            });\n          }\n\n          pellElement.content.innerHTML = textarea.value;\n          textarea.style.display = 'none';\n          pellElement.style.display = '';\n        } else {\n          textarea.style.display = '';\n          pellElement.style.display = 'none';\n        }\n      }\n\n      if (e.target.matches('.request_info_link')) {\n        const refElem = Utils.closest(e.target, 'tr.localization_key_row');\n        requestInfoRow = refElem.querySelector('.request_info_row');\n        if (requestInfoRow.classList.contains('hidden')) {\n          requestInfoRow.classList.remove('hidden');\n        } else {\n          requestInfoRow.classList.add('hidden');\n        }\n      }\n    });\n  });\n})","document.addEventListener('DOMContentLoaded', () => {\n  const loadingElement = document.querySelector('.loading');\n\n  const updateFunc = () => {\n    const sourceIdElement = document.querySelector('#source_id');\n    if (!sourceIdElement) { return; }\n\n    const sourceId = sourceIdElement.value;\n\n    fetch(`/lit/sources/${sourceId}/sync_complete`)\n      .then(resp => {\n        if (resp.ok) {\n          return resp.json();\n        } else {\n          return Promise.reject({ status: resp.status });\n        }\n      })\n      .then(json => {\n        if (json.sync_complete) {\n          loadingElement.classList.add('loaded');\n          loadingElement.classList.remove('loading');\n          clearInterval(interval);\n          location.reload();\n        }\n      })\n      .catch(error => {\n        switch (error.status) {\n          case 404:\n            loadingElement.innerHTML = 'Could not update synchronization status, please try refreshing page';\n            break;\n          case 401:\n            loadingElement.innerHTML = 'You are not authorized. Please check if you are properly logged in';\n            break;\n          case 500:\n            loadingElement.innerHTML = 'Something went wrong, please try synchronizing again';\n            break;\n          default:\n            loadingElement.innerHTML = 'An unknown error occurred. Please try again'\n        }\n        clearInterval(interval);\n      });\n  }\n\n  if (loadingElement) {\n    window.interval = setInterval(updateFunc, 500);\n  }\n\n  const tableElem = document.querySelector('.incomming-localizations-table');\n\n  tableElem && tableElem.addEventListener('click', e => {\n    const button = e.target;\n    if (button.matches('.js-accept-btn')) {\n      e.preventDefault();\n      const url = e.target.href;\n      fetch(url, {\n        method: 'GET',\n        headers: {\n          'X-CSRF-Token': Rails.csrfToken(),\n          'Content-Type': 'application/json'\n        }\n      })\n        .then(({ ok }) => {\n          if (ok) {\n            button.parentElement.parentElement.remove(); // remove row\n          } else {\n            alert('Localization could not be accepted.');\n          }\n        })\n    }\n\n    if (button.matches('.js-reject-btn')) {\n      e.preventDefault();\n      if (confirm(\"Are you sure?\")) {\n        const url = e.target.href;\n        fetch(url, {\n          method: 'DELETE',\n          headers: {\n            'X-CSRF-Token': Rails.csrfToken(),\n            'Content-Type': 'application/json'\n          }\n        })\n          .then(({ ok }) => {\n            if (ok) {\n              button.parentElement.parentElement.remove(); // remove row\n            } else {\n              alert('Localization could not be rejected.');\n            }\n          })\n      }\n    }\n  });\n\n  const acceptButtons = document.querySelectorAll('.js-accept-btn');\n  const rejectButtons = document.querySelectorAll('.js-reject-btn');\n})","document.addEventListener('click', e => {\n  if (e.target.matches('[data-toggle=\"dropdown\"]')) {\n    document._dropdownOpen = true;\n    e.target.parentElement.classList.toggle('open');\n  } else {\n    document._dropdownOpen && document.querySelectorAll('.dropdown.open, .btn-group.open').forEach(dropdown => dropdown.classList.remove('open'));\n    document._dropdownOpen = false;\n  }\n});","const Utils = {\n  closest: (refElem, selector) => {\n    while (!refElem.matches(selector)) {\n      refElem = refElem.parentNode;\n      if (!refElem) { return; }\n    }\n    return refElem;\n  }\n}\n\nexport default Utils;"]}